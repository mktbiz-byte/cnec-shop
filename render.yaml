services:
  # 백엔드 API 서버 (FastAPI)
  - type: web
    name: cnecplus-backend
    runtime: python
    env: python
    region: singapore
    plan: starter  # 24시간 실행을 위해 유료 플랜 권장 (무료는 15분 후 sleep)
    rootDir: ./backend
    buildCommand: "pip install -r requirements.txt"
    startCommand: "uvicorn app.main:app --host 0.0.0.0 --port $PORT"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: DATABASE_URL
        value: sqlite:///./cnecplus.db  # 프로덕션에서는 PostgreSQL 권장
      - key: SECRET_KEY
        generateValue: true
      - key: GEMINI_API_KEY
        sync: false  # Render 대시보드에서 직접 입력
      - key: YOUTUBE_API_KEY
        sync: false  # Render 대시보드에서 직접 입력
      - key: OPENAI_API_KEY
        sync: false  # 선택사항

  # 프론트엔드 웹사이트 (React/Vite)
  - type: web
    name: cnecplus-frontend
    runtime: node
    env: node
    region: singapore
    plan: free
    rootDir: ./frontend
    buildCommand: "cd client && pnpm install && pnpm run build"
    startCommand: "cd client && pnpm preview --host 0.0.0.0 --port $PORT"
    envVars:
      - key: NODE_VERSION
        value: 22.13.0
      - key: VITE_API_URL
        value: https://cnecplus-backend.onrender.com  # 백엔드 서비스 URL

  # 데이터 수집 Cron Job (매일 새벽 3시 실행)
  - type: cron
    name: cnecplus-collector
    runtime: python
    env: python
    region: singapore
    plan: free
    schedule: "0 3 * * *"  # 매일 새벽 3시 (UTC)
    rootDir: ./backend
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python -m app.tasks.youtube_collector"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: DATABASE_URL
        value: sqlite:///./cnecplus.db
      - key: YOUTUBE_API_KEY
        sync: false
